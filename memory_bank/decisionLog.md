# 决策日志

## 架构决策记录

### 决策 #001: 采用Turborepo Monorepo架构

[2025-01-11 15:56:24] - 项目初始化时选择Turborepo管理多应用

- **背景**: 需要管理前端、后端和共享包
- **决策**: 使用Turborepo + pnpm workspace
- **理由**:
  - 统一构建和依赖管理
  - 代码共享和类型安全
  - 开发效率提升
- **影响**: 所有应用共享构建配置和依赖管理

### 决策 #002: NestJS模块化架构

[2025-01-11 15:56:24] - 后端采用NestJS框架

- **背景**: 需要可扩展的Node.js后端架构
- **决策**: 采用NestJS + 模块化设计
- **理由**:
  - TypeScript原生支持
  - 依赖注入和装饰器
  - 丰富的生态系统
- **影响**: 每个功能独立模块，便于维护和测试

### 决策 #003: MikroORM数据库管理

[2025-01-11 15:56:24] - 选择MikroORM作为数据库ORM

- **背景**: 需要TypeScript友好的ORM
- **决策**: 使用MikroORM + PostgreSQL
- **理由**:
  - 优秀的TypeScript支持
  - 基于迁移的数据库管理
  - 灵活的查询构建器
- **影响**: 数据库结构通过迁移文件管理

### 决策 #004: JWT认证策略

[2025-01-11 15:56:24] - 实现JWT双token认证

- **背景**: 需要安全的认证机制
- **决策**: Access Token + Refresh Token
- **理由**:
  - 无状态认证
  - 自动token刷新
  - 更好的安全性
- **影响**: 前后端认证流程统一

### 决策 #005: 配置管理策略

[2025-01-11 15:56:24] - 当前待修复的ConfigModule配置问题

- **背景**: ConfigModule未设置为全局模块
- **问题**: 配置服务无法在其他模块中访问
- **待决策**: 添加isGlobal: true配置
- **预期影响**: 配置服务可在整个应用中访问

[2025-01-11 15:56:24] - 初始化决策日志

---

### 决策 #006: 修复ConfigModule全局配置

[2025-07-11 15:58:49] - 应用isGlobal: true修复

- **背景**: ConfigModule未设置为全局模块，导致服务无法注入。
- **决策**: 在`app.module.ts`中为`ConfigModule.forRoot()`添加`isGlobal: true`。
- **理由**: 确保ConfigService在整个应用程序中可用，无需在每个模块中单独导入。
- **影响**: 应用程序编译成功，但热重载导致EADDRINUSE错误。这表明原始配置问题已解决，现在是进程管理问题。

---

### 决策 #007: 修复编译错误

[2025-07-11 16:47:18] - 修复 `aliyun-drive` 模块的编译错误。

- **背景**: 项目在更新 Swagger 文档后出现两个编译错误，导致后端服务无法启动。
- **决策**:
  1.  为 `nestjs-backend` 添加 `@types/multer` 开发依赖，并在 `aliyun-drive.controller.ts` 中导入 `multer`，以解决 `Express.Multer.File` 类型未定义的问题。
  2.  在 `aliyun-drive.service.ts` 中，将 `axios` 配置的 `baseUrl` 属性更正为 `baseURL`。
- **理由**:
  1.  缺少 `multer` 的类型定义文件导致 TypeScript 编译器无法识别相关类型。
  2.  `axios` 库的配置项拼写错误。
- **影响**: 解决了编译错误，使后端服务能够正常编译和启动。
